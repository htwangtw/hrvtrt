# Analysis plan

Author: Hao-Ting Wang

There's a standing debate of the impact of physiology singal on fMRI data.
In denoising literature, various methods has be developed to remove physiology based noise ([Glover et al. 2000]).
Although BOLD signal is, theoratically, heavily confounded by physiology signals, researchers still found functional relevance of physiology signal after removing relevant confunds.
Literature in dynamic resting state fMRI analysis has shown that physiology data is highly relevant to the default mode network after accounting for physiology related noise. ([Chang et al. 2009])
Acativity in bilarteral insula correlated with the interaction of high-frequency continuous heart rate variability and emotion-arrosing audio inputs in movie watching paradign ([Nguyen et al., 2015]) as well as resting state ([Kassinopoulos et al., 2019]).
A study simulating BOLD from physiology data has recovered networks similar to canonical resting state networks found through clustering functional connectivity data ([Chen et al., 2020]).
From the converging evidence above, we designed this analyisis to understand the relevance of physiology signal in resting state functional connectivity and explore the individual differences of its cognitive and psychiatric relevance.
Firstly we will assess the test-retest reliablilty of the impact of physiology data on functional connectivity based measure.
If there's relevant and stable patter, we will explore the cognitive relevance of the connectivity pattern.

## Dataset and sample
We selected Enhanced NKI-rockland sample test-retest resting state data.
The retest sessions were collected 30 days after the baseline.
Only fMRI scans were done. The selection criteria is as followed:
* 9 minutes resting-state scan TR = 645 ms
* MPRAGE T1w scan in both sessions
* Physiology recording during the resting state scan

Sample basic property: 
* N = 189 (female N = 86)
* Age M = 12.25, SD = 3.02, range 6.64 - 20.37

A total of 97 cognitive assessments are availibe for the test-retest sample, but not all assessment were completed by the sample.
We will explore assessments with at leat 60% (114 subjects) of the data present.
Excluding file logging administrative details or demographic information (`MRI`, `mri_log_sheet`, `blood_collection`, `age`, `dem*`, `Track`), the filter leaves us 47 assessments for the exploratory analysis.

## fMRI data preprocessing

The data will be prerpoccessed with `fMRIprep v20.2.1`.
As suggested by previous literature ([Noble et al., 2019]), we used the `--longitudinal` flag to compute an average anatomical template for both sessions.
The preprocessed data is registered to the common standard `MNI152NLin2009cAsym` 2mm space.
See [`bin/fmriprep.sh`](bin/fmriprep.sh) for the cluster job submission file.

### Denoising

We employ the denoising strategy detailed in ([Chen et al., 2020]) 2.2.2. with RETROICOR ([Glover et al. 2000]) calculated from physiology recording, six motion parameters and high-pass filtering.
The motion-related and high-pass filtering parameters are generated by fMRIprep and implemented with python library `load_confound`.
RETROICOR parameter will be created as closely as possible to the implementation in [Chen et al., 2020].

## Physiological response functions
For the physiological response relevant to the functional connectivity analysis, we adopt strategy introduced by [Kassinopoulos et al., 2019].
The original MATLAB implementation can be found [here](https://github.com/mkassinopoulos/PRF_estimation).
<!---still need to read and research--->

## Functional connectivity
We will first reproduce the general linear model detailed in [Kassinopoulos et al., 2019] to understand the generate the basic activation related to the physiological response functions.

The next step is to explore edge-based connectivity measures and find edges that are most relevant to the physiological response function.
We will use the Shaefer 1000 for cortical region parcels and Tian S4 for subcortical parcels.
For each ROI, we calculate an interaction term of signal and the physiological data, and then correlated this interaction with the remaining raw signal extracted from ROIs.
This stwp will result in an asymetric functional connectiviy matrix for each subject.
We will also compute a group lebel the difussion embedding map of this assymetrical connectivity for exploration purpose.
<!---still need to read and research on the multiple comparison side of the problem--->


## Test-retest matric
For both univariate and multivariate test-retest reliability measure, we will use interclass correlation coefficient, see: [Noble et al., 2020]
<!---still need to read and research--->

## Reference

[Nguyen et al., 2015]: https://doi.org/10.1016/j.neuroimage.2015.08.078
[Glover et al. 2000]: https://doi.org/10.1002/1522-2594(200007)44:1<162::AID-MRM23>3.0.CO;2-E
[Chang et al. 2009]: https://doi.org/10.1016/j.neuroimage.2008.09.029
[Noble et al., 2019]: https://doi.org/10.1016/j.neuroimage.2019.116157
[Chen et al., 2020]: https://doi.org/10.1016/j.neuroimage.2020.116707
[Kassinopoulos et al., 2019]: https://doi.org/10.1016/j.neuroimage.2019.116150
[Noble et al., 2020]: https://academic.oup.com/cercor/article/27/11/5415/4139668#113551820
